\section{Vulnerabilidades Detetadas no Projeto}
\label{sec:vulnerabilidades-detetadas}

\subsection{DOM-based XSS}
\label{subsec:dom-based-xss}

O Cross-site Scripting (XSS) é uma das vulnerabilidades mais comuns em aplicações web, estando consistentemente no Top 10 da OWASP. Esta vulnerabilidade permite que atacantes injetem código malicioso (geralmente JavaScript) em páginas web visualizadas por outros utilizadores, comprometendo a integridade da aplicação e a segurança dos dados.

O DOM-based XSS representa uma variante específica desta vulnerabilidade, em que o ataque ocorre inteiramente no lado do cliente, ou seja, no navegador do utilizador. Ao contrário das abordagens tradicionais de XSS (refletido ou armazenado), que exploram respostas do servidor, o DOM-based XSS resulta de manipulações inseguras feitas pelo próprio código JavaScript da aplicação \cite{ref39}.

Neste tipo de ataque, o JavaScript lê dados potencialmente maliciosos provenientes de fontes como parâmetros do URL (\texttt{location.search}), fragmentos do URL (\texttt{location.hash}), armazenamento local (\texttt{localStorage}, \texttt{sessionStorage}) e mensagens recebidas via \texttt{postMessage}.

Estes dados são então inseridos diretamente no DOM através de funções conhecidas como \textit{sinks} inseguros, como o \texttt{innerHTML}, \texttt{outerHTML}, \texttt{insertAdjacentHTML}, \texttt{document.write}, \texttt{eval}, \texttt{new Function} e APIs que interpretam HTML ou JavaScript \cite{ref40}.

Se esses dados não forem devidamente validados e tratados, o navegador pode interpretar e executar o conteúdo malicioso, resultando em execução de código não autorizado \cite{ref38}.

\subsubsection{Riscos e Impacto dos Ataques DOM-based XSS}
\label{subsubsec:riscos-impacto-dom-xss}

Os ataques DOM-based XSS representam uma ameaça significativa à segurança das aplicações web, especialmente quando estas manipulam dados sensíveis ou sessões de utilizadores. Estes ataques podem ser explorados para:

\begin{itemize}
    \item \textbf{Roubo de dados} em que código malicioso pode ser executado no contexto da aplicação, permitindo o acesso a cookies (caso não estejam protegidos com a flag \texttt{HttpOnly}), tokens armazenados no \texttt{localStorage} ou \texttt{sessionStorage}, e outros dados confidenciais.
    
    \item \textbf{Manipulação da interface} pois o atacante pode alterar elementos visuais da página, simulando interfaces legítimas para enganar o utilizador (phishing).
    
    \item \textbf{Execução de ações não autorizadas} porque é possível orquestrar ataques como CSRF ou SSRF, explorando a confiança do navegador na origem da aplicação.
\end{itemize}

Esta vulnerabilidade é particularmente difícil de detetar, pois não envolve comunicação com o servidor, fazendo com que o código malicioso seja processado e executado exclusivamente no cliente \cite{ref39}. Além disso, como o código gerado por plataformas no-code (como a Base44) é frequentemente compilado e abstraído, torna-se ainda mais desafiante identificar e corrigir estas falhas.

\subsubsection{Boas práticas de prevenção}
\label{subsubsec:boas-praticas-prevencao-dom-xss}

A mitigação eficaz de DOM-based XSS deve ser integrada desde a fase de arquitetura até ao ciclo de desenvolvimento. Algumas estratégias recomendadas incluem \cite{ref40}, \cite{ref41}:

\begin{itemize}
    \item \textbf{Uso de APIs seguras} em que são preferíveis métodos como \texttt{textContent}, \texttt{setAttribute} (com validação), \texttt{value} para campos de formulário, e \texttt{createElement} com \texttt{appendChild}, em vez de \texttt{innerHTML} ou \texttt{eval}.
    
    \item \textbf{Tratamento robusto de dados} utilizando bibliotecas confiáveis com listas de permissões (\textit{allowlists}) para limpar dados antes de os inserir no DOM. Evitar soluções caseiras baseadas em expressões regulares, que são frequentemente insuficientes.
    
    \item \textbf{Codificação por contexto} em que se aplica \textit{output encoding} adequado ao tipo de conteúdo quer seja HTML, atributos, URLs, CSS ou JavaScript de modo a evitar interpretações indevidas.
    
    \item \textbf{Eliminação de funções perigosas} para isto evita-se completamente o uso de \texttt{eval} e \texttt{new Function}. Caso sejam indispensáveis, devem ser isoladas em ambientes controlados.
    
    \item \textbf{Políticas de segurança no navegador} implementando cabeçalhos como CSP com \textit{nonce} ou \textit{hash}, que ajudam a bloquear scripts injetados. Complementar com \texttt{X-Content-Type-Options: nosniff}, \texttt{Referrer-Policy} e \texttt{Permissions-Policy} para reduzir a superfície de ataque.
    
    \item \textbf{Minimização da superfície de confiança} limitando o acesso a fontes como \texttt{location}, \texttt{document.referrer} e \texttt{localStorage}, e validar rigorosamente o formato dos dados recebidos.
\end{itemize}

\subsubsection{Metodologias de teste}
\label{subsubsec:metodologias-teste-dom-xss}

A identificação de vulnerabilidades DOM-based XSS requer uma combinação de técnicas manuais e automáticas como \cite{ref38}, \cite{ref42}:

\begin{enumerate}
    \item \textbf{Mapeamento de fontes e sinks} em que se identifica onde os dados entram na aplicação (ex.: \texttt{location.search}, \texttt{postMessage}, inputs do utilizador) e onde são inseridos no DOM (ex.: \texttt{innerHTML}, \texttt{eval}, \texttt{insertAdjacentHTML}).
    
    \item \textbf{Revisão estática do código} analisando o JavaScript compilado ou minificado, procurando padrões perigosos. Ferramentas como \textit{source maps} ou \textit{prettifiers} podem ajudar a tornar o código mais legível.
    
    \item \textbf{Instrumentação dinâmica} recorrendo ferramentas como o DOM Invader (Burp Suite) ou DevTools para observar o comportamento do código em tempo real e seguir o caminho dos dados até aos \textit{sinks}.
    
    \item \textbf{Testes manuais seguros} em que se injetam marcadores identificáveis (ex.: \texttt{INJECTION\_TEST\_123}) nos pontos de entrada e se verifica se aparecem no DOM sem codificação adequada.
    
    \item \textbf{Ferramentas automáticas} e neste âmbito existem scanners especializados em DOM-XSS, como proposto por Melicher et al. \cite{ref42}, linters com plugins de segurança (ex.: ESLint), e ferramentas de análise de dependências para verificar bibliotecas externas que manipulam HTML.
    
    \item \textbf{Avaliação de mitigadores} confirmando que as políticas de segurança estão ativas e são eficazes, e que os métodos seguros estão a ser utilizados corretamente.
\end{enumerate}

\subsection{Potential Open Redirects}
\label{subsec:potential-open-redirects}

Os redirecionamentos abertos (\textit{open redirects}) constituem uma vulnerabilidade lógica que ocorre quando uma aplicação permite que o utilizador seja redirecionado para um URL externo, com base num parâmetro do URL, sem validação adequada. Esta falha pode ser explorada por atacantes para conduzir utilizadores a sites maliciosos, disfarçando o destino real por trás de um domínio legítimo. Embora não envolva execução de código diretamente, o impacto pode ser significativo, sobretudo em contextos de phishing, onde a confiança do utilizador na aplicação é essencial.

Durante a análise da aplicação desenvolvida com a plataforma Base44, foram identificadas estruturas de código que utilizam variáveis como \texttt{redirect} e \texttt{URL} na lógica de navegação. Embora não tenha sido demonstrada uma exploração direta, a presença destas variáveis sugere que o sistema pode aceitar valores externos para redirecionamento, o que representa um vetor de ataque potencial. Esta preocupação é corroborada por Khodayari et al. \cite{ref43}, que demonstram como redirecionamentos abertos podem ser explorados de forma sofisticada, desafiando a perceção comum de que são inofensivos.

\subsubsection{Riscos e implicações}
\label{subsubsec:riscos-implicacoes-open-redirects}

Os \textit{open redirects} podem ser explorados em diversos cenários:

\begin{itemize}
    \item Em ataques de \textbf{phishing}, o atacante pode enviar um link aparentemente legítimo que redireciona para uma página falsa, capturando credenciais do utilizador \cite{ref44}.
    
    \item Em sistemas de segurança baseados em listas de permissões, os users podem ser enganados, confiando no domínio inicial sem verificar o destino final \cite{ref43}.
    
    \item Em fluxos de autenticação como OAuth ou SSO, redirecionamentos mal validados podem permitir a captura de tokens de sessão \cite{ref45}.
    
    \item Além disso, o domínio legítimo pode ser usado para disseminar links maliciosos, afetando a reputação da aplicação.
\end{itemize}

\subsubsection{Estratégias de mitigação}
\label{subsubsec:estrategias-mitigacao-open-redirects}

A mitigação desta vulnerabilidade passa por várias abordagens:

\begin{itemize}
    \item \textbf{Listas de destinos permitidos}: A abordagem mais eficaz consiste na utilização de \textit{allowlists}, validando se o destino pertence a um conjunto de domínios ou caminhos autorizados \cite{ref45}.
    
    \item \textbf{Uso de caminhos relativos}: É recomendável o uso de caminhos relativos, como \texttt{next=/dashboard}, e a validação com \texttt{startsWith('/')}.
    
    \item \textbf{Evitar redirecionamentos arbitrários}: Em fluxos sensíveis, como a autenticação ou recuperação de senha, deve-se evitar redirecionamentos arbitrários.
    
    \item \textbf{Tokenização}: Uma alternativa segura é a tokenização, onde o parâmetro recebido é um identificador que mapeia para um URL seguro armazenado no servidor \cite{ref43}.
    
    \item \textbf{Validação rigorosa}: Deve incluir a canonicalização do URL, bloqueando esquemas perigosos como \texttt{javascript:} ou \texttt{data:} \cite{ref45}.
    
    \item \textbf{Página intermediária}: Em casos onde o redirecionamento externo é necessário, é aconselhável apresentar uma página intermediária que informe o utilizador sobre o destino, promovendo a transparência e reduzindo o risco de \textit{Social Engineering} \cite{ref44}.
\end{itemize}

\subsubsection{Metodologia de Teste}
\label{subsubsec:metodologia-teste-open-redirects}

A deteção de \textit{open redirects} pode ser realizada através de:

\begin{itemize}
    \item \textbf{Revisão de código}: procurando por padrões como \texttt{location.href}, \texttt{window.location}, \texttt{res.redirect}, \texttt{window.open}, entre outros \cite{ref46}.
    
    \item \textbf{Testes manuais}: consistem em injetar parâmetros controlados e observar o comportamento da aplicação, verificando se o redirecionamento ocorre sem validação.
    
    \item \textbf{Testes de bypass}: incluem variações como \texttt{//malicioso.com}, URLs com \texttt{@}, codificações Unicode ou esquemas obsoletos \cite{ref47}.
    
    \item \textbf{Validação de fluxos OAuth/SSO}: é essencial confirmar se o parâmetro \texttt{redirect\_uri} é validado contra uma lista segura \cite{ref45}.
    
    \item \textbf{Ferramentas automáticas}: como Burp Suite, ZAP e linters estáticos podem auxiliar na identificação de padrões vulneráveis \cite{ref48}.
    
    \item \textbf{Precauções durante testes}: é fundamental evitar redirecionamentos para domínios maliciosos, utilizando marcadores inócuos e documentando os passos de reprodução \cite{ref49}.
\end{itemize}